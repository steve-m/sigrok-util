From f6613f6a8036e6970002824da968bfe3f66f1264 Mon Sep 17 00:00:00 2001
From: Steve Markgraf <steve@steve-m.de>
Date: Fri, 30 Jan 2026 00:20:55 +0100
Subject: [PATCH] Allow building with MSYS2, use dynamic libs

---
 CMakeLists.txt | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index e0520e0..2f6bf32 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -51,9 +51,11 @@ option(STATIC_PKGDEPS_LIBS "Statically link to (pkg-config) libraries" FALSE)
 option(ENABLE_TS_UPDATE "Update .ts source files (Qt l10n)" FALSE)
 
 if(WIN32)
-	# On Windows/MinGW we need to statically link to libraries.
-	# This option is user configurable, but enable it by default on win32.
-	set(STATIC_PKGDEPS_LIBS TRUE)
+	# On Windows/MXE we need to statically link to libraries.
+	# This option is user configurable, but enable it by default on win32/MXE.
+	if(NOT DEFINED ENV{MSYSTEM})
+		set(STATIC_PKGDEPS_LIBS TRUE)
+	endif()
 
 	# Windows does not support UNIX signals.
 	set(ENABLE_SIGNALS FALSE)
@@ -631,7 +633,7 @@ else()
 	list(APPEND PULSEVIEW_LINK_LIBS ${PKGDEPS_LIBRARIES})
 endif()
 
-if(WIN32)
+if(WIN32 AND NOT DEFINED ENV{MSYSTEM})
 	# On Windows we need to statically link the libqsvg imageformat
 	# plugin (and the QtSvg component) for SVG graphics/icons to work.
 	# We also need QWindowsIntegrationPlugin, Qt5PlatformSupport (only for
-- 
2.52.0

